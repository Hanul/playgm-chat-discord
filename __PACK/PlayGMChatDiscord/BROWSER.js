PlayGMChatDiscord.MAIN=METHOD({run:()=>{const o=/(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-a-z\u0080-\uffff\d{1-3}]+\.)+(?:[a-z\u0080-\uffff]+))|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\u0000-\uffff~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\u0000-\uffff~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\u0000-\uffff~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\u0000-\uffff~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\u0000-\uffff~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\u0000-\uffff~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/i;let e,t,n,i=PlayGMChatDiscord.ROOM("Discord"),a=firebase.database().ref("connections-discord"),d=firebase.storage().ref("icons-discord"),s=firebase.storage().ref("uploads"),r={},l=STORE("PlayGMChat"),c=l.get("skin");void 0===c&&(c="디코");let f=SKINS[c];void 0===f&&(f=SKINS.디코);let u=()=>{void 0!==global.Notification&&"granted"!==Notification.permission&&Notification.requestPermission();let c;A({style:{position:"fixed",right:"Android"!==INFO.getOSName()&&"iOS"!==INFO.getOSName()?18:0,top:0,padding:10,zIndex:998,color:f.color},c:FontAwesome.GetIcon("bars"),on:{tap:()=>{void 0!==c&&c.remove(),c=UUI.PANEL({style:{position:"fixed",right:0,top:0,width:260,height:"100%",backgroundColor:"#444",color:"#fff",overflowY:"scroll",zIndex:999},contentStyle:{padding:20},c:[A({style:{position:"fixed",right:"Android"!==INFO.getOSName()&&"iOS"!==INFO.getOSName()?18:0,top:0,padding:10},c:FontAwesome.GetIcon("times"),on:{tap:()=>{c.remove(),c=void 0}}}),H3({style:{fontSize:30,fontWeight:"bold"},c:"MENU"}),A({style:{marginTop:10,display:"block",padding:10,border:"1px solid #fff",borderRadius:5},c:UUI.BUTTON_H({style:{margin:"auto"},icon:FontAwesome.GetIcon({style:{marginTop:2},key:"info-circle"}),spacing:10,title:"명령어"}),on:{mouseover:(o,e)=>{e.addStyle({backgroundColor:"#fff",color:"#000"})},mouseout:(o,e)=>{e.addStyle({backgroundColor:"transparent",color:"#fff"})},tap:()=>{N()}}}),A({style:{marginTop:10,display:"block",padding:10,border:"1px solid #fff",borderRadius:5},target:"_blank",href:"http://code.playgm.co.kr",c:UUI.BUTTON_H({style:{margin:"auto"},icon:FontAwesome.GetIcon({style:{marginTop:2},key:"code"}),spacing:10,title:"코드 프금"}),on:{mouseover:(o,e)=>{e.addStyle({backgroundColor:"#fff",color:"#000"})},mouseout:(o,e)=>{e.addStyle({backgroundColor:"transparent",color:"#fff"})}}}),A({style:{marginTop:10,display:"block",padding:10,border:"1px solid #fff",borderRadius:5},target:"_blank",href:"https://cafe.naver.com/playgm",c:UUI.BUTTON_H({style:{margin:"auto"},icon:FontAwesome.GetIcon({style:{marginTop:2},key:"coffee"}),spacing:10,title:"PlayGM 카페"}),on:{mouseover:(o,e)=>{e.addStyle({backgroundColor:"#fff",color:"#000"})},mouseout:(o,e)=>{e.addStyle({backgroundColor:"transparent",color:"#fff"})}}}),A({style:{marginTop:10,display:"block",padding:10,border:"1px solid #fff",borderRadius:5},target:"_blank",href:"https://github.com/Hanul/playgm-chat-firebase",c:UUI.BUTTON_H({style:{margin:"auto"},icon:FontAwesome.GetBrandIcon({style:{marginTop:1,width:14},key:"github"}),spacing:10,title:"소스코드"}),on:{mouseover:(o,e)=>{e.addStyle({backgroundColor:"#fff",color:"#000"})},mouseout:(o,e)=>{e.addStyle({backgroundColor:"transparent",color:"#fff"})}}}),A({style:{marginTop:10,display:"block",padding:10,border:"1px solid #fff",borderRadius:5},target:"_blank",href:"https://discordapp.com/channels/483554399243730959",c:UUI.BUTTON_H({style:{margin:"auto"},icon:FontAwesome.GetBrandIcon({style:{marginTop:1,width:14},key:"discord"}),spacing:10,title:"PlayGM 디스코드"}),on:{mouseover:(o,e)=>{e.addStyle({backgroundColor:"#fff",color:"#000"})},mouseout:(o,e)=>{e.addStyle({backgroundColor:"transparent",color:"#fff"})}}})]}).appendTo(BODY)}}}).appendTo(BODY);let u,p=[],g={},m=IMG({style:{position:"fixed",left:5,bottom:40},src:PlayGMChatDiscord.R("loading.svg")}).appendTo(BODY);BODY.addStyle({overflowY:"hidden"});let h=DIV({style:{backgroundColor:f.backgroundColor,color:f.color,paddingTop:10,overflowY:"scroll",onDisplayResize:(o,e)=>{return o<800?{fontSize:14,height:e-50}:{fontSize:"inherit",height:e-50}}},on:{tap:()=>{void 0!==c&&(c.remove(),c=void 0)}}}).appendTo(BODY),y=(DIV({style:{backgroundColor:f.backgroundColor,height:10}}).appendTo(BODY),()=>{h.scrollTo({top:999999})}),b=(o,e)=>{h.append(DIV({style:{color:f.systemColor,fontWeight:"bold",onDisplayResize:(o,e)=>{return o<800?{padding:"0 6px",paddingBottom:6}:{padding:"0 8px",paddingBottom:8}}},c:o})),e!==!1&&y()},N=()=>{b("명령어 : /명령어, /닉네임, /접속자, /스킨, /이모지, /프금, /로그아웃")},I=o=>{a.once("value",o=>{let e=[];o.forEach(o=>{e.push(o.val())});let t=0;e.forEach(o=>{o.time>t&&(t=o.time)});let n="",a=[];e.forEach(o=>{t-o.time<12e4&&(a.push(o),""!==n&&(n+=", "),n+=o.name)}),i.send("getMembers",o=>{b("오리진 유저("+a.length+"명) : "+n+" / 디스코드 유저("+o.split(",").length+"명) : "+o)})})},v=o=>{let n=s.child(o.name).put(o);n.on("state_changed",o=>{C.empty(),C.append(INTEGER(o.bytesTransferred/o.totalBytes*100))},()=>{C.empty(),C.append(FontAwesome.GetIcon("upload"))},()=>{C.empty(),C.append(FontAwesome.GetIcon("upload")),n.snapshot.ref.getDownloadURL().then(n=>{i.send({methodName:"sendFile",data:{userId:e.uid,name:e.displayName,userIconURL:t,fileName:o.name,downloadURL:n}})})})},O=t=>{m.remove();let i=h.getScrollTop()>=h.getScrollHeight()-h.getHeight()-10;if("485064204144082948"===t.userId&&(t.message.indexOf(":")===-1?t.name=void 0:(t.name=t.message.substring(0,t.message.indexOf(":")-1),t.message=t.message.substring(t.message.indexOf(":")+2))),t.name!==e.displayName||t.message!==n){if(p.push(t),void 0===t.name)b(t.message);else{let n;h.append(DIV({style:{onDisplayResize:(o,e)=>{return o<800?{padding:"0 6px",paddingBottom:6}:{padding:"0 8px",paddingBottom:8}}},c:[n=IMG({style:{marginRight:5,backgroundColor:"#fff",onDisplayResize:(o,e)=>{return o<800?{marginBottom:-4,width:18,height:18,borderRadius:18}:{marginBottom:-5,width:20,height:20,borderRadius:20}}},src:"485064204144082948"!==t.userId||void 0===r[t.name]?void 0===t.userIconURL||"485064204144082948"===t.userId?PlayGMChatDiscord.R("default-icon.png"):t.userIconURL:r[t.name]}),SPAN({style:{fontWeight:"bolder",marginRight:6,color:f.nameColor},c:t.name}),SPAN({style:{fontSize:0},c:" : "}),void 0!==t.downloadURL?A({style:{fontWeight:"bolder",textDecoration:"underline"},c:void 0!==t.fileName?t.fileName:t.downloadURL,target:"_blank",href:t.downloadURL,on:{mouseover:o=>{"Android"===INFO.getOSName()||"iOS"===INFO.getOSName()||void 0!==u||t.fileName.indexOf(".png")===-1&&t.fileName.indexOf(".jpg")===-1&&t.fileName.indexOf(".jpeg")===-1&&t.fileName.indexOf(".gif")===-1||(u=UUI.V_CENTER({style:{position:"fixed",left:o.getLeft()+10,top:o.getTop()-42-8,width:90,height:60,backgroundColor:"#fff",backgroundImage:t.downloadURL,backgroundSize:"cover",backgroundPosition:"center center",border:"1px solid #333",textAlign:"center"},c:IMG({style:{marginTop:5},src:PlayGMChatDiscord.R("loading.svg")})}).appendTo(BODY),IMG({src:t.downloadURL,on:{load:()=>{u.empty()}}}))},mouseout:()=>{void 0!==u&&(u.remove(),u=void 0)}}}):RUN(()=>{let n=t.message,a=[];return EACH(n.split(" "),(n,d)=>{d>0&&a.push(" ");let s=o=>{let n=o.match(/\<:[^\>]*\>/);if(n===TO_DELETE)a.push(o);else{let d=n[0],r=d.substring(1,d.length-1).toLowerCase(),l=o.indexOf(d);a.push(o.substring(0,l)),a.push(IMG({style:{marginBottom:-4,height:20},src:"https://cdn.discordapp.com/emojis/"+r.substring(r.lastIndexOf(":")+1)+".png",on:{load:()=>{i!==!0&&t.userId!==e.uid||y()}}})),o=s(o.substring(l+d.length))}return o},r=()=>{let e=n.match(o);if(e===TO_DELETE)n=s(n);else{let o=e[0];o.indexOf(" ")!==-1&&(o=o.substring(0,o.indexOf(" ")));let t=n.indexOf(o);n=s(n.substring(0,t)),n=n.substring(t+o.length),0!==o.indexOf("http://")&&0!==o.indexOf("https://")&&0!==o.indexOf("ftp://")&&(o="http://"+o),a.push(A({style:{textDecoration:"underline"},target:"_blank",href:o,c:o})),r()}};r()}),SPAN({c:a})})]})),"485064204144082948"===t.userId&&(void 0===g[t.name]&&(g[t.name]=[]),g[t.name].push(n),d.child(t.name).getDownloadURL().then(o=>{r[t.name]=o,EACH(g[t.name],e=>{e.setSrc(o)})}).catch(()=>{}))}i!==!0&&t.userId!==e.uid||y()}};i.send("messages",o=>{REVERSE_EACH(o,O),I(!0)}),i.on("message",o=>{O(o),o.name!==e.displayName&&(o.message+" ").indexOf("@"+e.displayName+" ")!==-1&&(void 0===global.Notification||"granted"!==Notification.permission?DELAY(()=>{i.send({methodName:"send",data:{userId:e.uid,name:e.displayName,userIconURL:t,message:"(호출 기능이 차단된 유저입니다)"}})}):document.hasFocus()!==!0&&(new Notification(o.name,{body:message}).onclick=(()=>{focus()})))}),EVENT("resize",()=>{DELAY(()=>{y()})});let T,S,E,C;FORM({style:{position:"fixed",bottom:0,width:"100%",boxShadow:"0 0 0.4em rgba(0, 0, 0, 0.15)"},c:[T=UUI.FULL_INPUT({style:{backgroundColor:f.backgroundColor,padding:10},inputStyle:{color:f.color},name:"message",placeholder:"메시지를 입력하세요.",isOffAutocomplete:!0,on:{tap:()=>{void 0!==c&&(c.remove(),c=void 0)},keydown:o=>{"Escape"===o.getKey()&&void 0!==S&&S.remove()},doubletap:()=>{void 0!==S&&S.remove(),S=DIV({style:{position:"fixed",left:5,bottom:43},c:[A({style:{flt:"left",padding:"4px 8px",border:"1px solid #999",backgroundColor:"#eee",borderRadius:3},c:"접속자",on:{tap:()=>{I()}}}),CLEAR_BOTH()]}).appendTo(BODY),EVENT_ONCE("tap",()=>{void 0!==S&&(S.remove(),S=void 0)})}}}),A({style:{position:"fixed",right:50,bottom:0,padding:8,color:"#ccc",fontSize:16},c:FontAwesome.GetIcon("cog"),on:{mouseover:(o,e)=>{e.addStyle({color:"#999"})},mouseout:(o,e)=>{e.addStyle({color:"#ccc"})},tap:()=>{let o,t,n,i=UUI.V_CENTER({style:{position:"fixed",left:0,top:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.75)"},c:[UUI.V_CENTER({style:{position:"relative",backgroundColor:"#fff",width:240,height:150,borderRadius:20,boxShadow:"0 0 2em rgba(0, 0, 0, 0.2)",margin:"auto",textAlign:"center"},c:[H3({style:{position:"absolute",left:20,top:20,fontWeight:"bolder"},c:"아이콘"}),o=INPUT({style:{position:"fixed",left:-999999,top:-999999},type:"file",on:{change:()=>{let i=o.getEl().files[0];void 0!==i.size&&i.size<=4096?(n.empty(),n.append("업로드 중..."),d.child(e.displayName).put(i).then(o=>{d.child(e.displayName).getDownloadURL().then(o=>{t.setSrc(o),n.empty(),n.append("PNG, 4KB 이하")})})):alert("파일 용량이 초과하였습니다.")}}}),A({c:t=IMG({style:{width:20,height:20,borderRadius:20},src:void 0===r[e.displayName]?PlayGMChatDiscord.R("default-icon.png"):r[e.displayName]}),on:{tap:()=>{o.select()}}}),n=P({style:{marginTop:5},c:"PNG, 4KB 이하"}),A({style:{position:"absolute",right:20,bottom:20,fontWeight:"bolder",textDecoration:"underline"},c:"닫기",on:{tap:()=>{i.remove()}}})]})]}).appendTo(BODY)}}}),E=INPUT({style:{position:"fixed",left:-999999,top:-999999},type:"file",on:{change:()=>{let o=E.getEl().files[0];void 0!==o.size&&o.size<=20971520?v(o):alert("제한 크기를 초과한 파일입니다.")}}}),C=A({style:{position:"fixed",right:10,bottom:0,padding:8,color:"#ccc",fontSize:16},c:FontAwesome.GetIcon("upload"),on:{mouseover:(o,e)=>{e.addStyle({color:"#999"})},mouseout:(o,e)=>{e.addStyle({color:"#ccc"})},tap:()=>{E.select()}}})],on:{submit:(o,a)=>{let d=a.getData().message;if(a.setData({}),""!==d)if("/"===d[0]){let o=d.substring(1).split(" "),t=o[0];if(o.shift(),"닉네임"===t){let t=e.displayName;0===o.length?b("사용법 : /닉네임 [name]"):t!==o[0]&&/^[ㄱ-ㅎ가-힣a-zA-Z0-9]{1,6}$/.test(o[0])===!0&&e.updateProfile({displayName:o[0]}).then(()=>{i.send({methodName:"send",data:{message:"[닉네임 변경] "+t+" -> "+e.displayName}})})}else if("접속자"===t)I();else if("스킨"===t)if(0===o.length){let o="";EACH(SKINS,(e,t)=>{""!==o&&(o+=", "),o+=t}),b("사용법 : /스킨 [skin], 스킨 종류 : "+o)}else void 0!==SKINS[o[0]]&&(l.save({name:"skin",value:o[0]}),location.reload());else"이모지"===t?i.send("getEmojis",o=>{let e=["이모지 종류 : "];EACH(o.split(", "),(o,t)=>{t>0&&e.push(", "),e.push(IMG({style:{marginBottom:-4,height:20},src:"https://cdn.discordapp.com/emojis/"+o.substring(o.lastIndexOf(":")+1,o.length-1)+".png",on:{load:()=>{y()}}})),e.push(" "+o)}),b(e)}):"로그아웃"===t?firebase.auth().signOut():"프금"===t?open("https://cafe.naver.com/playgm"):N()}else{let o={userId:e.uid,name:e.displayName,userIconURL:t,message:d.trim()};i.send({methodName:"send",data:o}),O(o),n=d.trim()}}}}).appendTo(BODY),T.focus(),INTERVAL(60,RAR(()=>{a.child(e.uid).set({name:e.displayName,time:firebase.database.ServerValue.TIMESTAMP})})),EVENT("paste",o=>{EACH(o.getClipboardItems(),e=>{if(e.type.indexOf("image")!==-1){let t=e.getAsFile();return void 0!==t.size&&t.size<=20971520?confirm("클립보드의 이미지를 업로드 하시겠습니까?")===!0&&v(t):alert("제한 크기를 초과한 파일입니다."),o.stopDefault(),!1}})}),"Android"!==INFO.getOSName()&&"iOS"!==INFO.getOSName()&&(EVENT("dragover",o=>{o.stop()}),EVENT("mousemove",o=>{void 0!==u&&u.addStyle({left:o.getLeft()+10,top:o.getTop()-u.getHeight()-8})}),EVENT("drop",o=>{EACH(o.getFiles(),v),o.stopDefault()})),d.child(e.displayName).getDownloadURL().then(o=>{t=o,r[e.displayName]=o,EACH(g[e.displayName],e=>{e.setSrc(o)})}).catch(()=>{})};firebase.auth().onAuthStateChanged(o=>{if(o===TO_DELETE){let o=DIV({style:{marginTop:20}}).appendTo(BODY);new firebaseui.auth.AuthUI(firebase.auth()).start(o.getEl(),{signInOptions:[firebase.auth.EmailAuthProvider.PROVIDER_ID],callbacks:{signInSuccessWithAuthResult:t=>{return o.remove(),void 0===e&&(e=t.user,u()),!1}}})}else void 0===e&&(e=o,u())})}}),global.SKINS={"기본":{backgroundColor:"#fff",color:"#444",nameColor:"#444",systemColor:"#080"},"다크":{backgroundColor:"#252526",color:"#dcdcdc",nameColor:"#569cd6",systemColor:"#090"},"디코":{backgroundColor:"rgb(54, 57, 64)",color:"rgb(195, 196, 198)",nameColor:"#fff",systemColor:"rgb(114, 137, 218)"}};